async function refreshTable(n=1,t={}){try{t.Page=n;t.PageSize=pageNumber;t.keyword=$("#searchInput").val();t.Categories=[...document.querySelectorAll("#collapseCategory input:checked")].map(n=>n.value);t.Statuses=[...document.querySelectorAll("#collapseStatus input:checked")].map(n=>n.value);t.DateFrom=$("#dateFrom").val();t.DateTo=$("#dateTo").val();t.__RequestVerificationToken=$('input[name="__RequestVerificationToken"]').val();let i=await $.ajax({url:"/LostInfo/SearchSelect",type:"POST",data:JSON.stringify(t),contentType:"application/json"});if(i.tableHtml.trim()===""&&n>1)return await refreshTable(n-1,t);$("#tableBody").html(i.tableHtml);$("#pagination").html(i.paginationHtml);$("#paginationInfo").text(n);$("#delectAll, #selectNum").hide();$("#checkAll").prop("checked",!1)}catch(i){alert("更新列表失敗："+i.responseText||i.statusText)}}let pageNumber=parseInt($("#pageSizeSelect").val())||10;$(function(){function i(){let n=[],r=$("#collapseCategory input:checked").map(function(){return $(this).next("label").text()}).get();r.length&&n.push("<strong>分類：<\/strong>"+r.join(", "));let u=$("#collapseStatus input:checked").map(function(){return $(this).next("label").text()}).get();u.length&&n.push("<strong>狀態：<\/strong>"+u.join(", "));let t=$("#dateFrom").val(),i=$("#dateTo").val();(t||i)&&n.push("<strong>日期：<\/strong>"+(t?t:"不限")+" ~ "+(i?i:"不限"));n.length?($("#selectedFiltersDiv").show(),$("#selectedFiltersText").html(n.join("&nbsp;&nbsp;&nbsp;&nbsp;"))):($("#selectedFiltersDiv").hide(),$("#selectedFiltersText").html(""))}function r(){let n=0;$("#collapseCategory input:checked").length>0&&n++;$("#collapseStatus input:checked").length>0&&n++;($("#dateFrom").val()||$("#dateTo").val())&&n++;n>0?($("#filterCount").show(),$("#filterCount").text(`${n}`)):$("#filterCount").hide()}$(document).on("click",".checkbox",function(){let t=$(this).prop("checked"),n=$(".checkbox:checked").length;n>0?($("#delectAll, #selectNum").show(),$("#selectNum").text(`已選取${n}項`)):$("#delectAll, #selectNum").hide();t?$(this).closest("tr").addClass("active"):$(this).closest("tr").removeClass("active");$("#checkAll").prop("checked",$(".checkbox").length===$(".checkbox:checked").length)});$("#checkAll").click(function(){if($(this).prop("checked")){$(".checkbox").prop("checked",!0);$("tbody tr").addClass("active");$("#delectAll, #selectNum").show();let n=$(".checkbox:checked").length;n>0&&$("#selectNum").text(`已選取${n}項`)}else $(".checkbox").prop("checked",!1),$("tbody tr").removeClass("active"),$("#delectAll, #selectNum").hide()});$("#delectAllYes").click(function(){let n=$(".checkbox:checked").map(function(){return $(this).val()}).get();if(n.length!==0){var t=$('input[name="__RequestVerificationToken"]').val();$.ajax({url:"/LostInfo/DeleteMultiple",type:"POST",data:{__RequestVerificationToken:t,ids:n},traditional:!0,success:function(){let n=parseInt($("#paginationInfo").text())||1;refreshTable(n);$(".checkbox:checked").closest("tr").remove();$("#delectAll, #selectNum").hide();$("#checkAll").prop("checked",!1)},error:function(){alert("刪除失敗！")}})}});$("#btnSearch").on("click",()=>{console.log($("#searchInput").val()),refreshTable(1),i()});$("#searchInput").on("keyup",()=>{console.log($("#searchInput").val()),refreshTable(1),i()});$("#filterFinsh").click(function(){r();i();let u=[...document.querySelectorAll("#collapseCategory input:checked")].map(n=>n.value),f=[...document.querySelectorAll("#collapseStatus input:checked")].map(n=>n.value),e=$("#dateFrom").val(),o=$("#dateTo").val(),s={categories:u,statuses:f,dateFrom:e,dateTo:o};refreshTable(1);var t=$(this).closest(".dropdown").find(".dropdown-toggle")[0],n=bootstrap.Dropdown.getInstance(t);n||(n=new bootstrap.Dropdown(t));n.hide()});document.querySelector(".btn-outline-search").addEventListener("click",function(){document.querySelectorAll("input[type=checkbox]").forEach(n=>n.checked=!1);document.getElementById("dateFrom").value="";document.getElementById("dateTo").value="";document.getElementById("searchInput").value="";i();r();refreshTable(1)});const t=document.getElementById("dateFrom"),n=document.getElementById("dateTo");t.addEventListener("change",()=>{t.value?(n.min=t.value,n.value&&n.value<t.value&&(n.value="")):n.min=""});$(".pagination").on("click",".pagination .page-link",function(n){n.preventDefault();let t=$(this).data("page");refreshTable(t)});$(document).on("click",".btn-detail",function(){var n=$(this),t,i,r;$("#offcanvasName").text(n.data("name"));$("#offcanvasDesc").text(n.data("desc"));$("#offcanvasfounddate").text(n.data("founddate"));$("#offcanvasCreatedDate").text(n.data("createddate"));$("#offcanvasStatus").text(n.data("status"));$("#offcanvasImage").attr("src",n.data("image"));n.data("status")==="已領取"?($("#ownerNameWrapper").show(),$("#ownerPhoneWrapper").show(),$("#offcanvasOwnerName").text(n.data("ownername")),$("#offcanvasOwnerPhone").text(n.data("ownerphone"))):($("#ownerNameWrapper").hide(),$("#ownerPhoneWrapper").hide());t=n.data("id");$("#offcanvasEditBtn").attr("href","/LostInfo/Edit/"+t);$("#offcanvasDeleteBtn").attr("data-id",t);$("#deleteModal").on("show.bs.modal",function(){$("#deleteOne").attr("action","/LostInfo/Delete/"+t)});i=document.getElementById("offcanvasDetail");r=bootstrap.Offcanvas.getOrCreateInstance(i);r.show()});$(document).on("click","#deleteOnebtn",async function(n){n.preventDefault();let u=$(this).closest("form"),f=u.attr("action"),t=f.split("/").pop();if(t){let e=$('input[name="__RequestVerificationToken"]').val(),o=parseInt($("#paginationInfo").text())||1;try{await $.ajax({url:"/LostInfo/Delete",type:"POST",data:{id:t,__RequestVerificationToken:e}});refreshTable(o);var s=document.getElementById("offcanvasDetail"),i=bootstrap.Offcanvas.getInstance(s);i&&i.hide();$("#deleteModal").modal("hide")}catch(r){alert("刪除失敗："+(r.responseText||r.statusText))}}});$("#pageSizeSelect").on("change",function(){pageNumber=parseInt($(this).val());console.log("pageNumber 更新為:",pageNumber);refreshTable(1)})});