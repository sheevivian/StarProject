@model IEnumerable<StarProject.Models.Emp>
@using StarProject.Helpers

@foreach (var item in Model)
{
    var deptCode = item.DeptNoNavigation?.DeptCode ?? "UNKNOWN";
    var roleInfo = RoleHelper.GetRoleDisplayInfo(deptCode, item.RoleNoNavigation);

    <tr data-emp-id="@item.No"
        data-emp-code="@item.EmpCode"
        data-name="@item.Name"
        data-department="@deptCode"
        data-role="@item.RoleNoNavigation?.RoleName"
        data-hire-date="@item.HireDate.ToString("yyyy-MM-dd")"
        data-status="@(item.Status ? "在職" : "離職")"
        data-department-display="@roleInfo.DepartmentDisplayName"
        data-role-display="@roleInfo.RoleDisplayName">

        <!-- 重要：添加 value 屬性 -->
        <td style="width:50px">
            <input class="form-check-input ms-4 checkbox"
                   type="checkbox"
                   value="@item.No"
                   data-emp-id="@item.No">
        </td>

        <td style="width:200px">
            <div class="emp-name">@item.Name</div>
        </td>

        <td style="width:150px">
            <span>@item.EmpCode</span>
        </td>

        <td>
            <div>@roleInfo.DepartmentDisplayName</div>
        </td>

        <td>
            <div>
                <span>@roleInfo.RoleDisplayName</span>
            </div>
            <small class="text-muted d-block">
                @roleInfo.PermissionSummary
            </small>
        </td>

        <td>
            <span>@item.HireDate.ToString("yyyy/MM/dd")</span>
            <small class="text-muted d-block">
                @{
                    var years = DateTime.Now.Year - item.HireDate.Year;
                    var months = DateTime.Now.Month - item.HireDate.Month;
                    if (months < 0) { years--; months += 12; }
                }
                年資 @years 年 @months 個月
            </small>
        </td>

        <td>
            @if (item.Status)
            {
                <span class="badge bg-success">在職</span>
            }
            else
            {
                <span class="badge bg-secondary">離職</span>
            }
        </td>

        <!-- 修改：使用正確的 data-bs-target 和 CSS 類別 -->
        <td style="width:116px">
            <div class="btn-group" role="group">
                <button type="button"
                        class="btn btn-sm btn-outline-primary btn-detail"
                        data-bs-toggle="modal"
                        data-bs-target="#detailModal"
                        data-id="@item.No"
                        data-name="@item.Name"
                        data-empcode="@item.EmpCode"
                        data-department="@roleInfo.DepartmentDisplayName"
                        data-role="@roleInfo.RoleDisplayName"
                        data-hiredate="@item.HireDate.ToString("yyyy-MM-dd")"
                        data-status="@(item.Status ? "在職" : "離職")">
                    詳細內容
                </button>
            </div>
        </td>
    </tr>
}