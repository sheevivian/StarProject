@model StarProject.Models.ProductIntroduce;
   
@{
    ViewData["Title"] = "商品介紹編輯";
}

<head>
    <link href="~/css/textediting.css" rel="stylesheet" />
    <style>
        .btn-topbar {
            --bs-btn-bg: rgb(250, 208, 72);
            --bs-btn-border-color: rgb(250, 208, 72);
            --bs-btn-hover-bg: rgba(250, 208, 72, 0.692);
            --bs-btn-hover-border-color: rgba(250, 208, 72, 0.692);
            --bs-btn-focus-shadow-rgb: 217, 164, 6;
            --bs-btn-active-bg: #ffcd39;
            --bs-btn-active-border-color: #ffc720;
            --bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
        }

        .btn-outline-back {
            --bs-btn-color: #DC3545;
            --bs-btn-border-color: #DC3545;
            --bs-btn-hover-color: #DC3545;
            --bs-btn-hover-bg: #f8e6e9;
            --bs-btn-hover-border-color: #DC3545;
            --bs-btn-focus-shadow-rgb: 255, 193, 7;
            --bs-btn-active-color: #DC3545;
            --bs-btn-active-border-color: #DC3545;
            --bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
            --bs-gradient: none;
        }

        .ck-editor__editable {
            min-height: 430px; /* 編輯區最小高度 */
        }

        #carouselExampleIndicators .carousel-inner {
            height: 500px; /* 你想要的高度 */
        }

        #carouselExampleIndicators .carousel-inner .carousel-item img {
            height: 100%;
            width: auto; /* 保持比例 */
            object-fit: cover; /* 填滿容器裁切 */
            object-position: center; /* 裁切以圖片中心對齊 */
        }

        .card-header{
            background-color:#2B4C8C;
            color:#FFFFFF
        }

        .sortable-placeholder {
            background: #f0f0f0;
            border: 2px dashed #bbb;
            height: 100px; /* 依你 li 的高度調整 */
            border-radius: 8px;
        }
    </style>
    
</head>

<h1 class="fw-bold">商品介紹編輯</h1>
<hr />

<div class="row">
    <form asp-action="Create" method="post" enctype="multipart/form-data" style="width:100%">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <div class="row g-3 align-items-stretch">
            <!-- 左側：基本資訊 + 圖片 -->
            <div class="col-lg-6 d-flex flex-column gap-3">
                <div class="card  h-100">
                    <div class="card-header fw-bold fs-4"><strong>基本資訊</strong></div>
                    <div class="card-body">
                        <div class="form-group d-flex align-items-center row">
                            <div class="col-4 col-lg-2 fw-bold fs-5">
                                <label asp-for="ProductNo" class="control-label fw-bold fs-4"></label>
                            </div>
                            <div class="col-8 col-lg-10 fs-5">
                                <input asp-for="ProductNo" readonly class="form-control-plaintext" />
                            </div>
                        </div>
                        <div class="form-group d-flex align-items-center row">
                            <div class="col-4 col-lg-2 fw-bold fs-5">
                                <label asp-for="ProductNoNavigation.Name" class="control-label fw-bold fs-4"></label>
                            </div>
                            <div class="col-8 col-lg-10 fs-5">
                                <input asp-for="ProductNoNavigation.Name" readonly class="form-control-plaintext" />
                            </div>
                        </div>
                        <div class="form-group mb-3">
                            <div class="fw-bold fs-5">
                                <label asp-for="Point" class="control-label fw-bold fs-5"></label><span asp-validation-for="Point" class="text-danger ms-3"></span>
                                <textarea asp-for="Point" class="form-control" rows="5" cols="50" style="resize: none;" placeholder="選填，最多50個字"></textarea>
                            </div>
                        </div>
                        
                        <!-- Carousel 預覽 + 拖曳排序 -->
                        <div class="mb-3">
                            <div id="carouselExampleIndicators" class="carousel slide">
                                <div class="carousel-indicators" id="carouselIndicators">
                                    <!-- 動態生成 indicator -->
                                    @{
                                        var i = 0;
                                        foreach (var img in Model.ProductNoNavigation.ProductImages)
                                        {
                                            <button type="button" data-bs-target="#carouselExampleIndicators"
                                                data-bs-slide-to="@i" class="@(i == 0 ? "active" : "")" aria-label="Slide ${@i+1}">
                                            </button>
                                            i++;
                                        }
                                      }
                                </div>
                                <div class="carousel-inner" id="carouselInner">
                                    @{
                                        var j = 0;
                                    
                                    foreach (var item in Model.ProductNoNavigation.ProductImages)
                                    {
                                        <div class="carousel-item @(j == 0 ? "active" : "")">
                                            <img src="@item.Image" class="d-block w-100" style="height:500px; object-fit:cover; object-position: center;">
                                        </div>
                                        j++;
                                    }
                                    }
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">上一張</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">下一張</span>
                                </button>
                            </div>
                        </div>

                        <!-- 縮圖拖曳區 -->
                        <div class="mb-2">
                            <ul id="imagePreviewList" class="list-unstyled d-flex gap-2">
                                <!-- 動態生成縮圖 -->
                                    @{
                                        var k = 0;
                                    }
                                    @foreach (var item in Model.ProductNoNavigation.ProductImages)
                                    {
                                    <li class="position-relative d-inline-block me-2" style="width:100px;height:80px;" data-index="@(k == 0 ? "active" : "")">
                                    <img src="@item.Image" class="img-thumbnail w-100 h-100" style="object-fit:cover;">
                                    <button type="button" class="btn-close btn-close-white position-absolute remove-btn" style="top:2px;right:2px;"></button>
                                </li>
                                    k++;
                                }
                            </ul>
                            <small id="dragTip" class="text-muted" style="display:none;">可拖曳排序圖片</small>
                        </div>

                    </div>
                </div>
            </div>

            <!-- 右側：文章編輯 -->
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header fw-bold fs-4"><strong>商品介紹</strong></div>
                    <div class="card-body d-flex flex-column">
                        <div class="form-group mb-2">
                            <textarea asp-for="Description" id="editor" class="form-control"></textarea>
                        </div>    
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group d-flex gap-3 mt-3 text-distance justify-content-center">
            <button type="submit" class="btn btn-topbar fw-bold fs-5 text-distance" style="width:303px">
                <i class="fa-solid fa-plus"></i>新增
            </button>
            <a asp-action="Index" class="btn btn-outline-back fw-bold fs-5" style="width:303px">返回列表</a>
        </div>
    </form>
</div>


@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script>
  

    </script>

    <script src="~/lib/ckeditor5-build-classic-master/build/ckeditor.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const textarea = document.querySelector('#editor');

            ClassicEditor
                .create(textarea, {
                    language: 'zh',
                    toolbar: [
                        'heading', '|',
                        'bold', 'italic', 'blockQuote', 'bulletedList', 'numberedList', '|',
                        'imageUpload', 'link', 'mediaEmbed', 'insertTable', '|',
                        'undo', 'redo'
                    ],
                    ckfinder: {
                        // uploadUrl: '/CompanyNotifies/UploadImage'
                    }
                })
                .then(editor => {
                    // 只綁一次事件
                    editor.model.document.on('change:data', () => {
                        textarea.value = editor.getData();
                        // console.log(textarea.value); // 可以保留或刪掉
                    });
                })
                .catch(error => {
                    console.error(error);
                });
        });
    </script>
}
