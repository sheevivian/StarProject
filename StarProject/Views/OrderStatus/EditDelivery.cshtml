@model StarProject.Models.OrderDelivery

<style>
    body {
        background-image: url(https://cdn.pixabay.com/photo/2021/01/17/02/02/planets-5923806_1280.jpg);
        background-color: black;
    }
    /* 📦 訂單流程 timeline 水平條 */
    .progress-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        margin: 40px auto 60px;
        max-width: 700px;
    }

        .progress-container::before {
            content: '';
            background: #dcdcdc;
            position: absolute;
            top: 50%;
            left: 0;
            height: 4px;
            width: 100%;
            transform: translateY(-50%);
            z-index: 0;
            border-radius: 2px;
        }

    .progress-step {
        position: relative;
        z-index: 1;
        background: #dcdcdc;
        color: #8E8E8E;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        transition: 0.3s ease;
    }

        .progress-step.active {
            background: #4c5bd4;
            color: #fff;
        }

    .progress-label {
        position: absolute;
        top: 50px;
        font-size: 0.9rem;
        text-align: center;
        width: 100px;
        transform: translateX(-30%);
        color: #fff;
    }

    /* 🟦 卡片統一美化 */
    .card.card-narrow {
        max-width: 700px;
        margin: 0 auto;
        /* border-radius: 16px; */
        overflow: hidden;
        border-radius: 31px;
        background: linear-gradient(145deg, #f6f6f6, #cfcfcf);
        box-shadow: 9px 9px 18px #9a9a9a, -9px -9px 18px #ffffff;
        ;
    }

    /* 🟦 標題橫幅 */
    .card-header {
        font-size: 1.2rem;
        padding: 0.85rem 1.25rem;
        border-bottom: none;
        letter-spacing: 0.5px;
    }

        /* 收件資訊：深藍色 */
        .card-header.bg-purple {
            background: linear-gradient(135deg, #FFAE00, #FFAE00);
            color: #BEBEBE;
        }

        /* 出貨進度：深黃色 */
        .card-header.bg-info {
            background: linear-gradient(135deg, #003060, #003060);
            color: #BEBEBE;
        }

    /* 🖋 可讀only時乾淨、編輯時醒目 */
    .readonly-plain {
        border: none !important;
        background-color: transparent !important;
        padding-left: 0;
        padding-right: 0;
        box-shadow: none !important;
        transition: all 0.2s ease;
    }

    .highlight-field:not(.readonly-plain):focus {
        border-color: #4c5bd4;
        box-shadow: 0 0 0 0.2rem rgba(76, 91, 212, 0.25);
    }

    /* ✏️ 表單標題文字微強調 */
    .form-label.fw-semibold {
        color: #444;
        font-weight: 600;
    }

    /* 📝 Timeline 美化 */
    .timeline li {
        position: relative;
        border-color: #d0d7e2 !important;
    }

        .timeline li::before {
            content: "";
            position: absolute;
            left: -8px;
            top: 4px;
            width: 12px;
            height: 12px;
            background: #4c5bd4;
            border-radius: 50%;
        }

    .timeline .badge {
        background-color: #4c5bd4 !important;
    }

    /* 💠 按鈕滑鼠互動感 */
    .btn {
        transition: all 0.2s ease-in-out;
    }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
        }

</style>
<h1 class="text-center my-4 text-white">出貨管理</h1>

<div class="progress-container">
    <div class="progress-step active">
        1
        <div class="progress-label">選擇訂單</div>
    </div>
    <div class="progress-step active ">
        2
        <div class="progress-label">建立出貨單</div>
    </div>
    <div class="progress-step active ">
        3
        <div class="progress-label ">出貨單確認</div>
    </div>
</div>
<div class="container mt-5">

    <!-- 📦 收件資訊 + 修改/刪除/返回 -->
    <div class="card card-narrow shadow-sm border-0 mb-4 rounded-3">
        <div class="card-header bg-purple text-white fw-bold">
            <i class="bi bi-person-circle me-2"></i>收件人資訊
        </div>
        <div class="card-body">
            <!-- 🔹 UpdateDelivery form -->
            <form asp-action="UpdateDelivery" method="post" class="row g-3">
                <input type="hidden" asp-for="DeliveryId" />

                <div class="col-md-6">
                    
                    <label asp-for="RecipientName" class="form-label fw-semibold">收件人</label>
                    <input asp-for="RecipientName"
                           class="form-control readonly-plain highlight-field"
                           readonly id="RecipientName" />
                </div>

                <div class="col-md-6">
                    <label asp-for="RecipientPhone" class="form-label fw-semibold">電話</label>
                    <input asp-for="RecipientPhone"
                           class="form-control readonly-plain highlight-field"
                           readonly id="RecipientPhone" />
                </div>

                <div class="col-12">
                    <label asp-for="RecipientAddress" class="form-label fw-semibold">地址</label>
                    <input asp-for="RecipientAddress"
                           class="form-control readonly-plain highlight-field"
                           readonly id="RecipientAddress" />
                </div>

                <div class="col-12">
                    <label asp-for="Notes" class="form-label fw-semibold">備註</label>
                    <textarea asp-for="Notes"
                              class="form-control readonly-plain highlight-field"
                              rows="2" readonly id="Notes"></textarea>
                </div>

                <!-- 修改 / 儲存按鈕 -->
                <div class="mt-3 d-flex justify-content-start gap-2">
                    <button type="button" id="btnEdit" class="btn btn-outline-primary px-4">
                        <i class="bi bi-pencil-square me-1"></i>修改
                    </button>
                    <button type="submit" id="btnSave" class="btn btn-success px-4" style="display:none;">
                        <i class="bi bi-save me-1"></i>儲存
                    </button>
                </div>
            </form>

            <!-- ⚠️ 刪除 / 返回 按鈕 (獨立 form / link) -->
            <div class="mt-3 d-flex justify-content-end gap-2">
                <form asp-action="DeleteDelivery" method="post"
                      onsubmit="return confirm('⚠️ 確定要刪除此出貨單嗎？相關出貨狀態也會一併刪除！');">
                    <input type="hidden" name="id" value="@Model.DeliveryId" />
                    <button type="submit" class="btn btn-danger btn-sm">
                        <i class="bi bi-trash3 me-1"></i>刪除出貨單
                    </button>
                </form>

                <a asp-action="Index" class="btn btn-success btn-sm">
                    確認送出
                </a>
            </div>
        </div>
    </div>

    <!-- 🚚 出貨進度 -->
    <div class="card card-narrow shadow-sm border-0 mb-4 rounded-3">
        <div class="card-header bg-info text-white fw-bold">
            <i class="bi bi-truck me-2"></i>出貨進度
        </div>
        <div class="card-body">
            <!-- 時間軸 -->
            <ul class="timeline list-unstyled mb-4">
                @foreach (var status in Model.OrderStatuses.OrderBy(s => s.StatusTime))
                {
                    <li class="mb-3 border-start ps-3">
                        <span class="badge bg-secondary">@status.StatusType</span>
                        <div class="small text-muted mt-1">
                            @status.StatusTime.ToString("yyyy/MM/dd HH:mm")
                        </div>
                        <div>@status.Notes</div>
                    </li>
                }
            </ul>

            <!-- 更新狀態 -->
            <form asp-action="UpdateStatus" method="post" class="d-flex flex-wrap align-items-center gap-2">
                <input type="hidden" name="deliveryId" value="@Model.DeliveryId" />
            </form>
        </div>
    </div>

</div>

@section Scripts {
    <script>
        document.getElementById("btnEdit").addEventListener("click", function () {
            document.querySelectorAll("#RecipientName,#RecipientAddress,#RecipientPhone,#Notes")
                .forEach(el => {
                    el.removeAttribute("readonly");
                    el.classList.remove("readonly-plain");
                });
            document.getElementById("btnSave").style.display = "inline-block";
            this.style.display = "none";
        });
    </script>
}
