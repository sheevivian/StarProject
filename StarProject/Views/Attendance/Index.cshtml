@using StarProject.Models
@{
	ViewData["Title"] = "出勤紀錄";
}

<style>
	body {
		font-family: Arial, sans-serif;
		background-color: #f5f5f5;
	}

	.attendance-container {
		background: white;
		padding: 30px;
		border-radius: 10px;
		box-shadow: 0 2px 10px rgba(0,0,0,0.1);
		margin-bottom: 20px;
		max-width: 1000px;
		margin: 0 auto 20px auto;
	}

	h1, h2 {
		color: #333;
		margin: 0;
	}

	.records-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		margin-bottom: 20px;
	}

	.nav-btn {
		display: inline-block;
		padding: 10px 18px;
		text-decoration: none;
		color: white;
		border-radius: 6px;
		font-weight: bold;
		transition: all 0.2s ease;
		white-space: nowrap;
	}

		.nav-btn:hover {
			transform: translateY(-1px);
			text-decoration: none;
			color: white;
			opacity: .95;
		}

	.btn-leave {
		background-color: #17a2b8;
	}

		.btn-leave:hover {
			background-color: #138496;
		}

	.btn-logout {
		background-color: #6c757d;
	}

		.btn-logout:hover {
			background-color: #5a6268;
		}

	.table-rounded {
		background: white;
		border-radius: 10px;
		overflow: hidden;
		box-shadow: 0 2px 10px rgba(0,0,0,0.1);
		margin-top: 20px;
	}

	.records-table {
		width: 100%;
		border-collapse: collapse;
		margin: 0;
		background: white;
	}

		.records-table th, .records-table td {
			border: none;
			border-bottom: 1px solid #dee2e6;
			padding: 12px;
			text-align: center;
		}

		.records-table th {
			background-color: #2B4C8C;
			color: white;
			font-weight: bold;
			border-bottom: 2px solid #dee2e6;
		}

		.records-table tr:hover {
			background-color: rgba(0,123,255,0.05);
		}

		.records-table tr:last-child td {
			border-bottom: none;
		}

	.today-record {
		background-color: #fff3cd !important;
		font-weight: bold;
	}

		.today-record:hover {
			background-color: #ffeaa7 !important;
		}

	.page-actions {
		max-width: 1000px;
		margin: 0 auto 24px auto;
		text-align: center;
	}

	.message-alert {
		position: fixed;
		top: 20px;
		right: 20px;
		z-index: 1000;
		min-width: 300px;
		padding: 15px 20px;
		border-radius: 6px;
		font-weight: bold;
		display: none;
		animation: slideIn 0.3s ease-out;
	}

	.message-success {
		background-color: #d4edda;
		color: #155724;
		border: 1px solid #c3e6cb;
	}

	.message-error {
		background-color: #f8d7da;
		color: #721c24;
		border: 1px solid #f5c6cb;
	}

	@@keyframes slideIn {
		from {
			transform: translateX(100%);
			opacity: 0;
		}

		to {
			transform: translateX(0);
			opacity: 1;
		}
	}

	@@media (max-width: 768px) {
		.attendance-container {
			margin: 10px;
			padding: 20px;
		}

		.records-header {
			flex-direction: column;
			align-items: flex-start;
			gap: 12px;
		}

			.records-header .nav-btn {
				align-self: stretch;
				text-align: center;
			}
	}
</style>

<div class="attendance-container">
	<div class="records-header">
		<h2>📊 最近出勤紀錄</h2>
		<a href="@Url.Action("Index", "Leave")" class="nav-btn btn-leave">📝 請假申請</a>
	</div>

	<div class="table-rounded">
		<table class="records-table">
			<thead>
				<tr>
					<th>日期</th>
					<th>星期</th>
					<th>上班時間</th>
					<th>下班時間</th>
					<th>工作時數</th>
				</tr>
			</thead>
			<tbody>
				@if (ViewBag.RecentRecords != null && ((List<AttendanceRecord>)ViewBag.RecentRecords).Any())
				{
					@foreach (var record in (List<AttendanceRecord>)ViewBag.RecentRecords)
					{
						var isToday = record.ClockDate == DateOnly.FromDateTime(DateTime.Today);
						var workHours = record.ClockOutTime.HasValue && record.ClockInTime.HasValue
						? record.ClockOutTime.Value - record.ClockInTime.Value
						: (TimeSpan?)null;

						<tr class="@(isToday ? "today-record" : "")">
							<td>@record.ClockDate.ToString("MM/dd")</td>
							<td>
								@{
									string dayOfWeekChinese = record.ClockDate.DayOfWeek.ToString() switch
									{
										"Monday" => "週一",
										"Tuesday" => "週二",
										"Wednesday" => "週三",
										"Thursday" => "週四",
										"Friday" => "週五",
										"Saturday" => "週六",
										"Sunday" => "週日",
										_ => record.ClockDate.DayOfWeek.ToString()
									};
								}
								@dayOfWeekChinese
							</td>
							<td>@(record.ClockInTime?.ToString("HH:mm") ?? "-")</td>
							<td>@(record.ClockOutTime?.ToString("HH:mm") ?? "-")</td>
							<td>@(workHours?.ToString(@"hh\:mm") ?? "-")</td>
						</tr>
					}
				}
				else
				{
					<tr>
						<td colspan="5" style="color: #666; font-style: italic;">還沒有打卡記錄</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
</div>

<div class="page-actions">
	<a href="@Url.Action("Index", "Login")" class="nav-btn btn-logout">🚪 登出系統</a>
</div>

<div id="messageAlert" class="message-alert">
	<span id="messageText"></span>
</div>

@Html.AntiForgeryToken()

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	function showMessage(message, isError = false) {
		const alertDiv = document.getElementById('messageAlert');
		const messageText = document.getElementById('messageText');

		messageText.textContent = message;
		alertDiv.className = `message-alert ${isError ? 'message-error' : 'message-success'}`;
		alertDiv.style.display = 'block';

		setTimeout(() => { alertDiv.style.display = 'none'; }, 3000);
	}
</script>